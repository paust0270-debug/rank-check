━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
  네이버 순위 체크 배치 시스템 - 사용 설명서
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

이 시스템은 keywords_navershopping 테이블의 키워드를 자동으로 가져와서
네이버 쇼핑 순위를 체크하고 결과를 데이터베이스에 저장합니다.

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
📦 1. 초기 설정 (처음 한 번만 실행)
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

1-1. Node.js 설치 확인
   - Node.js가 설치되어 있지 않다면 https://nodejs.org에서 LTS 버전 다운로드
   - 설치 후 컴퓨터 재시작 권장

1-2. setup.bat 실행
   ① setup.bat 파일에서 마우스 우클릭
   ② "관리자 권한으로 실행" 선택
   ③ 자동으로 진행됨:
      - pnpm 설치
      - .env 파일 생성 (Supabase 연결 정보 포함)
      - 프로젝트 의존성 설치
      - Puppeteer Chromium 다운로드 (약 200MB)
      - 초기 테스트 실행 (1개 키워드)

1-3. 설정 완료 확인
   - "✅ 설정 완료!" 메시지가 나오면 성공
   - 문제 발생 시 화면의 에러 메시지를 확인하세요

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
▶️ 2. 수동 실행 (필요할 때마다 실행)
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

2-1. 기본 실행 (모든 키워드 처리)
   - run-rank-check.bat 더블클릭

2-2. 제한된 개수만 처리
   - 명령 프롬프트(CMD)를 열고 다음 명령어 실행:

   cd D:\Project\turafic\batch-scripts
   run-rank-check.bat --limit=10        # 처음 10개만 처리
   run-rank-check.bat --batches=3       # 3배치(30개)만 처리

2-3. 실행 결과
   - 화면에 실시간 진행 상황 표시
   - 완료 후 batch-scripts\logs 폴더에 로그 파일 자동 저장
   - 로그 파일명 형식: rank-check-YYYYMMDD-HHMM.log

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
⏰ 3. 자동 스케줄링 (Windows 작업 스케줄러)
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

매일 자동으로 순위 체크를 실행하려면 Windows 작업 스케줄러를 사용하세요.

3-1. 작업 스케줄러 열기
   ① Windows 키를 누르고 "작업 스케줄러" 검색
   ② "작업 스케줄러" 앱 실행

3-2. 새 작업 만들기
   ① 오른쪽 패널에서 "기본 작업 만들기" 클릭
   ② 이름: "네이버 순위 체크"
   ③ 설명: "keywords_navershopping 테이블의 키워드 순위 자동 체크"
   ④ "다음" 클릭

3-3. 트리거 설정 (실행 시간)
   ① "매일" 선택 → "다음"
   ② 시작 날짜/시간 설정 (예: 매일 오전 2:00)
   ③ "다음" 클릭

3-4. 동작 설정 (실행할 프로그램)
   ① "프로그램 시작" 선택 → "다음"
   ② 프로그램/스크립트:
      D:\Project\turafic\batch-scripts\run-rank-check.bat
   ③ 시작 위치 (선택 사항):
      D:\Project\turafic
   ④ "다음" 클릭

3-5. 완료
   ① 설정 내용 확인
   ② "마침" 클릭

3-6. 고급 설정 (선택 사항)
   작업 스케줄러 라이브러리에서 방금 만든 작업을 더블클릭하여:
   - "조건" 탭: "컴퓨터의 전원이 AC 전원일 때만..." 체크 해제
   - "설정" 탭: "작업이 실패하면 다시 시작 간격" 설정 가능

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
🔧 4. 문제 해결 (Troubleshooting)
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

4-1. "관리자 권한이 필요합니다" 에러
   해결: setup.bat 파일에서 우클릭 → "관리자 권한으로 실행"

4-2. "Node.js가 설치되지 않았습니다" 에러
   해결: https://nodejs.org에서 Node.js LTS 버전 설치 후 재시작

4-3. "pnpm 설치 실패" 에러
   해결:
   - 인터넷 연결 확인
   - 명령 프롬프트(관리자)에서 수동 설치:
     npm install -g pnpm

4-4. "의존성 설치 실패" 에러
   해결:
   - 프로젝트 폴더에 package.json 파일이 있는지 확인
   - 수동 설치:
     cd D:\Project\turafic
     pnpm install

4-5. "Chromium 다운로드 실패" 에러
   해결:
   - 인터넷 연결 확인
   - 방화벽/보안 프로그램 임시 해제 후 재시도

4-6. "초기 테스트 실패" 에러
   해결:
   - keywords_navershopping 테이블에 데이터가 있는지 확인
   - Supabase 연결 정보(.env 파일) 확인
   - 로그 메시지를 읽고 구체적인 에러 확인

4-7. "순위 체크 중 오류" (실행은 되지만 결과 안 나옴)
   해결:
   - 네이버 보안 정책으로 인한 일시적 차단 가능
   - 1시간 정도 대기 후 재시도
   - batch-scripts\logs 폴더의 로그 파일 확인

4-8. 작업 스케줄러에서 실행이 안 됨
   해결:
   - 작업 스케줄러에서 작업 우클릭 → "실행" 으로 수동 테스트
   - "기록" 탭에서 에러 로그 확인
   - "조건" 탭에서 "컴퓨터의 전원이..." 체크 해제
   - 시작 위치(working directory)가 올바른지 확인

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
📊 5. 데이터베이스 구조
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

5-1. keywords_navershopping (작업 대기열)
   - 처리할 키워드 목록
   - 순위 체크 후 자동으로 삭제됨

5-2. slot_naver (현재 순위 상태)
   - 각 키워드의 현재 순위 저장
   - current_rank 필드가 업데이트됨

5-3. slot_rank_naver_history (순위 변동 이력)
   - 모든 순위 체크 결과를 시간순으로 저장
   - 순위 변화 추적 가능 (rank_change, start_rank_diff)

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
📁 6. 파일 구조
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

D:\Project\turafic\
├── batch-scripts\
│   ├── setup.bat              # 초기 설정 스크립트
│   ├── run-rank-check.bat     # 순위 체크 실행 스크립트
│   ├── README.txt             # 이 파일
│   └── logs\                  # 실행 로그 저장 폴더
│       └── rank-check-YYYYMMDD-HHMM.log
├── rank-check\
│   ├── batch\
│   │   └── check-batch-keywords.ts  # 메인 로직
│   ├── parallel\
│   │   └── parallel-rank-checker.ts # 병렬 체크 엔진
│   └── utils\
│       └── save-rank-to-slot-naver.ts  # DB 저장 로직
├── .env                       # Supabase 연결 정보 (자동 생성)
└── package.json               # 프로젝트 설정

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
ℹ️ 7. 추가 정보
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

처리 성능:
- 배치 크기: 10개 키워드 동시 처리
- 평균 속도: 약 4개/분 (10개당 2-3분)
- 배치 간 대기 시간: 10초 (네이버 차단 방지)

순위 범위:
- 최대 15페이지까지 검색 (약 600개 상품)
- 600위 내에 없으면 "미발견"(-1)으로 저장

로그 보관:
- batch-scripts\logs 폴더에 자동 저장
- 필요시 수동으로 오래된 로그 삭제 가능

문의:
- 기술 지원이 필요하면 개발팀에 문의하세요
- 로그 파일을 함께 첨부하면 빠른 해결 가능

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
버전: 1.0.0
최종 업데이트: 2025-01-26
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
